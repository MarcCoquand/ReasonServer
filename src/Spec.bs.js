// Generated by BUCKLESCRIPT VERSION 5.0.4, PLEASE EDIT WITH CARE
'use strict';

var Json = require("@glennsl/bs-json/src/Json.bs.js");
var $$Array = require("bs-platform/lib/js/array.js");
var Curry = require("bs-platform/lib/js/curry.js");
var Belt_Map = require("bs-platform/lib/js/belt_Map.js");
var Belt_Option = require("bs-platform/lib/js/belt_Option.js");
var Caml_option = require("bs-platform/lib/js/caml_option.js");
var Json_decode = require("@glennsl/bs-json/src/Json_decode.bs.js");
var Result$Cause = require("./Result.bs.js");
var Request$Cause = require("./Request.bs.js");
var Response$Cause = require("./Response.bs.js");
var MediaType$Cause = require("./MediaType.bs.js");
var Caml_js_exceptions = require("bs-platform/lib/js/caml_js_exceptions.js");

function id(x) {
  return x;
}

function setHandler(handler, builder) {
  return Result$Cause.lmap((function (param) {
                return Request$Cause.pure(handler, param);
              }), builder);
}

function compose(f, g, x) {
  return Curry._1(f, Curry._1(g, x));
}

function json(decoder) {
  return /* tuple */[
          /* Json */1,
          (function (a) {
              return Belt_Option.flatMap(Json.parse(a), (function (value) {
                            try {
                              return Caml_option.some(Curry._1(decoder, value));
                            }
                            catch (raw_exn){
                              var exn = Caml_js_exceptions.internalToOCamlException(raw_exn);
                              if (exn[0] === Json_decode.DecodeError) {
                                return undefined;
                              } else {
                                throw exn;
                              }
                            }
                          }));
            })
        ];
}

var Accept = /* module */[/* json */json];

function plain(encoder) {
  return /* tuple */[
          /* Plain */2,
          Curry.__1(encoder)
        ];
}

function json$1(encoder) {
  return /* tuple */[
          /* Json */1,
          (function (a) {
              return Json.stringify(Curry._1(encoder, a));
            })
        ];
}

var Contenttype = /* module */[
  /* plain */plain,
  /* json */json$1
];

function accept(contentTypes, builder) {
  var makeEncoder = function (req) {
    var partial_arg = Belt_Map.fromArray($$Array.of_list(contentTypes), Request$Cause.MediaComparer);
    return Result$Cause.attempt("Unsupported Media Type: " + MediaType$Cause.toString(req[/* accept */7]), /* UnsupportedMediaType415 */30, /* Html */0, (function (param) {
                  return Belt_Map.get(partial_arg, param);
                }), req[/* accept */7]);
  };
  return Result$Cause.andThen(Result$Cause.merge(Result$Cause.runFailsafe(Response$Cause.map)), Result$Cause.branch(Result$Cause.run(makeEncoder), builder));
}

function query(parameter, parser) {
  return Result$Cause.first(Result$Cause.runFailsafe((function (param) {
                    return Request$Cause.query(parameter, parser, param);
                  })));
}

function contentType(errorContent, contentTypes) {
  var acceptsMap = Belt_Map.fromArray($$Array.of_list(contentTypes), Request$Cause.MediaComparer);
  var decodeBody = function (req) {
    return Result$Cause.attempt("Could not parse body with content type: " + MediaType$Cause.toString(req[/* contentType */5]), /* BadRequest400 */15, errorContent, (function (param) {
                  return Request$Cause.decodeBody(acceptsMap, param);
                }), req);
  };
  return Result$Cause.first(Result$Cause.run(decodeBody));
}

function handle(code, handler, builder) {
  return Result$Cause.dimap((function (request) {
                return /* tuple */[
                        Request$Cause.pure(handler, request),
                        Response$Cause.lift
                      ];
              }), (function (param) {
                return Response$Cause.setCode(code, param);
              }), Result$Cause.andThen(Result$Cause.merge(Result$Cause.runFailsafe((function (body, response) {
                            return /* record */[
                                    /* code */response[/* code */0],
                                    /* headers */response[/* headers */1],
                                    /* contentType */response[/* contentType */2],
                                    /* body */body,
                                    /* encoding */response[/* encoding */4]
                                  ];
                          }))), Result$Cause.andThen(Result$Cause.first(Result$Cause.run((function (request) {
                                return request[/* arguments */3];
                              }))), builder)));
}

exports.id = id;
exports.setHandler = setHandler;
exports.compose = compose;
exports.Accept = Accept;
exports.Contenttype = Contenttype;
exports.accept = accept;
exports.query = query;
exports.contentType = contentType;
exports.handle = handle;
/* Request-Cause Not a pure module */
